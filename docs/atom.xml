<?xml version="1.0" encoding="utf-8"?>


<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-US">
    <title type="text">MrSheep&#39;s Blog</title>
    <subtitle type="html">MemE is a powerful and highly customizable GoHugo theme for personal blogs.</subtitle>
    <updated>2019-11-16T17:54:57+08:00</updated>
    <id>https://example.com/</id>
    <link rel="alternate" type="text/html" href="https://example.com/" />
    <link rel="self" type="application/atom+xml" href="https://example.com/atom.xml" />
    <author>
            <name>reuixiy</name>
            <uri>https://example.com/</uri>
            
                <email>reuixiy@gmail.com</email>
            </author>
    <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</rights>
    <generator uri="https://gohugo.io/" version="0.59.1">Hugo</generator>
        <entry>
            <title type="text">Overture 配置</title>
            <link rel="alternate" type="text/html" href="https://example.com/posts/overture-cfg/" />
            <id>https://example.com/posts/overture-cfg/</id>
            <updated>2019-11-16T17:35:29+08:00</updated>
            <published>2019-11-16T17:04:11+08:00</published>
            <author>
                    <name>reuixiy</name>
                    <uri>https://io-oi.me/</uri>
                    <email>reuixiy@gmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</rights><summary type="html"><![CDATA[Overture是一個由GO編寫的DNS，跨平台兼容，能夠很好的實現我分流的需求，相比与CoreDNS无论如何我都編譯不成功的proxy插件，實在是便捷了很多]]></summary>
            
                <content type="html"><![CDATA[<p>Overture是一個由GO編寫的DNS，跨平台兼容，能夠很好的實現我分流的需求，相比与CoreDNS无论如何我都編譯不成功的proxy插件，實在是便捷了很多</p>

<h2 id="features">Features</h2>

<p>摘自<a href="https://github.com/shawn1m/overture" target="_blank">github.com/shawn1m/overture</a></p>

<ul>
<li>Full IPv6 support</li>
<li>Multiple DNS upstream

<ul>
<li>Via UDP/TCP with custom port</li>
<li>Via SOCKS5 proxy (TCP only)</li>
<li>With EDNS Client Subnet (ECS) <a href="https://tools.ietf.org/html/rfc7871" target="_blank">RFC7871</a></li>
</ul></li>
<li>Dispatcher

<ul>
<li>IPv6 record (AAAA) redirection</li>
<li>Custom domain</li>
<li>Custom IP network</li>
</ul></li>
<li>Minimum TTL modification</li>
<li>Hosts (Random order if there are multiple answers)</li>
<li>Cache with ECS</li>
</ul>

<h2 id="配置">配置</h2>

<p>從<a href="https://github.com/shawn1m/overture/releases" target="_blank">Release</a>裡下載prebuilt版，並解壓</p>

<p>下載GFW和CN_ip列表,放置於同一目錄</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">wget https://cokebar.github.io/gfwlist2dnsmasq/gfwlist_domain.txt <span class="o">&amp;&amp;</span> wget https://raw.githubusercontent.com/17mon/china_ip_list/master/china_ip_list.txt</code></pre></td></tr></table>
</div>
</div>
<p>之後就可以魔改配置文件了</p>

<p><code>vim config.json</code></p>

<p>我的配置文件如下,國內走DNSPod，114，AliDNS；國外走CF，Google，OpenDNS</p>

<p>支持EDNS的我開了auto，國外的走DoT</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json">  <span class="s2">&#34;BindAddress&#34;</span><span class="err">:</span> <span class="s2">&#34;:53&#34;</span><span class="err">,</span> <span class="err">//監聽地址</span>
  <span class="s2">&#34;DebugHTTPAddress&#34;</span><span class="err">:</span> <span class="s2">&#34;127.0.0.1:5555&#34;</span><span class="err">,</span>
  <span class="s2">&#34;PrimaryDNS&#34;</span><span class="err">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;DNSPod&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Address&#34;</span><span class="p">:</span> <span class="s2">&#34;119.29.29.29:53&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;udp&#34;</span><span class="p">,</span>
      <span class="nt">&#34;SOCKS5Address&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Timeout&#34;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
      <span class="nt">&#34;EDNSClientSubnet&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;Policy&#34;</span><span class="p">:</span> <span class="s2">&#34;auto&#34;</span><span class="p">,</span>
        <span class="nt">&#34;ExternalIP&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
        <span class="nt">&#34;NoCookie&#34;</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;114&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Address&#34;</span><span class="p">:</span> <span class="s2">&#34;114.114.114.114&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;udp&#34;</span><span class="p">,</span>
      <span class="nt">&#34;SOCKS5Address&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Timeout&#34;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
      <span class="nt">&#34;EDNSClientSubnet&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;Policy&#34;</span><span class="p">:</span> <span class="s2">&#34;disable&#34;</span><span class="p">,</span>
        <span class="nt">&#34;ExternalIP&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
        <span class="nt">&#34;NoCookie&#34;</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;RubyFish&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Address&#34;</span><span class="p">:</span> <span class="s2">&#34;dns.rubyfish.cn:853&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;tcp-tls&#34;</span><span class="p">,</span>
      <span class="nt">&#34;SOCKS5Address&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Timeout&#34;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
      <span class="nt">&#34;EDNSClientSubnet&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;Policy&#34;</span><span class="p">:</span> <span class="s2">&#34;disable&#34;</span><span class="p">,</span>
        <span class="nt">&#34;ExternalIP&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
        <span class="nt">&#34;NoCookie&#34;</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;AliDNS&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Address&#34;</span><span class="p">:</span> <span class="s2">&#34;223.5.5.5:53&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;udp&#34;</span><span class="p">,</span>
      <span class="nt">&#34;SOCKS5Address&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Timeout&#34;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
      <span class="nt">&#34;EDNSClientSubnet&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;Policy&#34;</span><span class="p">:</span> <span class="s2">&#34;auto&#34;</span><span class="p">,</span>
        <span class="nt">&#34;ExternalIP&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
        <span class="nt">&#34;NoCookie&#34;</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span><span class="err">,</span>
  <span class="s2">&#34;AlternativeDNS&#34;</span><span class="err">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;CloudFlareDNS&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Address&#34;</span><span class="p">:</span> <span class="s2">&#34;one.one.one.one:853&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;tcp-tls&#34;</span><span class="p">,</span>
      <span class="nt">&#34;SOCKS5Address&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Timeout&#34;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
      <span class="nt">&#34;EDNSClientSubnet&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;Policy&#34;</span><span class="p">:</span> <span class="s2">&#34;disable&#34;</span><span class="p">,</span>
        <span class="nt">&#34;ExternalIP&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
        <span class="nt">&#34;NoCookie&#34;</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;GoogleDNS&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Address&#34;</span><span class="p">:</span> <span class="s2">&#34;dns.google:853&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;tcp-tls&#34;</span><span class="p">,</span>
      <span class="nt">&#34;SOCKS5Address&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Timeout&#34;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
      <span class="nt">&#34;EDNSClientSubnet&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;Policy&#34;</span><span class="p">:</span> <span class="s2">&#34;disable&#34;</span><span class="p">,</span>
        <span class="nt">&#34;ExternalIP&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
        <span class="nt">&#34;NoCookie&#34;</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;OpenDNS&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Address&#34;</span><span class="p">:</span> <span class="s2">&#34;208.67.222.222:443&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;tcp&#34;</span><span class="p">,</span>
      <span class="nt">&#34;SOCKS5Address&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Timeout&#34;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
      <span class="nt">&#34;EDNSClientSubnet&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;Policy&#34;</span><span class="p">:</span> <span class="s2">&#34;auto&#34;</span><span class="p">,</span>
        <span class="nt">&#34;ExternalIP&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
        <span class="nt">&#34;NoCookie&#34;</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span><span class="err">,</span>
  <span class="s2">&#34;OnlyPrimaryDNS&#34;</span><span class="err">:</span> <span class="kc">false</span><span class="err">,</span>
  <span class="s2">&#34;IPv6UseAlternativeDNS&#34;</span><span class="err">:</span> <span class="kc">false</span><span class="err">,</span>
  <span class="s2">&#34;WhenPrimaryDNSAnswerNoneUse&#34;</span><span class="err">:</span> <span class="s2">&#34;PrimaryDNS&#34;</span><span class="err">,</span>
  <span class="s2">&#34;IPNetworkFile&#34;</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">&#34;Primary&#34;</span><span class="p">:</span> <span class="s2">&#34;./china_ip_list.txt&#34;</span><span class="p">,</span>
    <span class="nt">&#34;Alternative&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span>
  <span class="p">}</span><span class="err">,</span>
  <span class="s2">&#34;DomainFile&#34;</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">&#34;Primary&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
    <span class="nt">&#34;Alternative&#34;</span><span class="p">:</span> <span class="s2">&#34;./gfwlist_domain.txt&#34;</span><span class="p">,</span>
    <span class="nt">&#34;Matcher&#34;</span><span class="p">:</span>  <span class="s2">&#34;regex-list&#34;</span>
  <span class="p">}</span><span class="err">,</span>
  <span class="s2">&#34;HostsFile&#34;</span><span class="err">:</span> <span class="s2">&#34;./hosts_sample&#34;</span><span class="err">,</span>
  <span class="s2">&#34;MinimumTTL&#34;</span><span class="err">:</span> <span class="mi">0</span><span class="err">,</span>
  <span class="s2">&#34;DomainTTLFile&#34;</span> <span class="err">:</span> <span class="s2">&#34;./domain_ttl_sample&#34;</span><span class="err">,</span>
  <span class="s2">&#34;CacheSize&#34;</span> <span class="err">:</span> <span class="mi">99</span><span class="err">,</span> <span class="err">//緩存條數</span>
  <span class="s2">&#34;RejectQType&#34;</span><span class="err">:</span> <span class="p">[</span><span class="mi">255</span><span class="p">]</span>
<span class="err">}</span></code></pre></td></tr></table>
</div>
</div>
<p>個人比較推薦<a href="https://github.com/Unitech/pm2" target="_blank">PM2</a>作爲進程管理</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">npm install pm2 -g
<span class="c1">#如果你沒nodejs可以使用 wget -qO- https://getpm2.com/install.sh | bash</span>
pm2 start overture-linux -- -c ./config.json</code></pre></td></tr></table>
</div>
</div>
<h2 id="測試">測試</h2>

<p>最後的話就dig測試一下就好了拉，</p>

<div class="notice tip" >
<p class="first notice-title"></p><p>用我的域名測試的話，我的域名是被污染了的</p></div>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="p">;</span> &lt;&lt;&gt;&gt; DiG <span class="m">9</span>.11.5-P4-5.1-Debian &lt;&lt;&gt;&gt; blog.mrsheep.xyz @127.0.0.1 -p <span class="m">15353</span>
<span class="p">;;</span> global options: +cmd
<span class="p">;;</span> Got answer:
<span class="p">;;</span> -&gt;&gt;HEADER<span class="s">&lt;&lt;- opco</span>de: QUERY, status: NOERROR, id: <span class="m">18416</span>
<span class="p">;;</span> flags: qr rd ra ad<span class="p">;</span> QUERY: <span class="m">1</span>, ANSWER: <span class="m">2</span>, AUTHORITY: <span class="m">0</span>, ADDITIONAL: <span class="m">1</span>

<span class="p">;;</span> OPT PSEUDOSECTION:
<span class="p">;</span> EDNS: version: <span class="m">0</span>, flags:<span class="p">;</span> udp: <span class="m">512</span>
<span class="p">;;</span> QUESTION SECTION:
<span class="p">;</span>blog.mrsheep.xyz.              IN      A

<span class="p">;;</span> ANSWER SECTION:
blog.mrsheep.xyz.       <span class="m">299</span>     IN      A       <span class="m">104</span>.27.165.30
blog.mrsheep.xyz.       <span class="m">299</span>     IN      A       <span class="m">104</span>.27.164.30

<span class="p">;;</span> Query time: <span class="m">535</span> msec
<span class="p">;;</span> SERVER: <span class="m">127</span>.0.0.1#15353<span class="o">(</span><span class="m">127</span>.0.0.1<span class="o">)</span>
<span class="p">;;</span> WHEN: Fri Nov <span class="m">15</span> <span class="m">19</span>:16:43 PST <span class="m">2019</span>
<span class="p">;;</span> MSG SIZE  rcvd: <span class="m">109</span></code></pre></td></tr></table>
</div>
</div>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">CoreDNS配置</title>
            <link rel="alternate" type="text/html" href="https://example.com/posts/coredns-cfg/" />
            <id>https://example.com/posts/coredns-cfg/</id>
            <updated>2019-11-16T17:35:07+08:00</updated>
            <published>2019-09-19T19:27:40+08:00</published>
            <author>
                    <name>reuixiy</name>
                    <uri>https://io-oi.me/</uri>
                    <email>reuixiy@gmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</rights><summary type="html"><![CDATA[CoreDNS是一個由GO語言編寫的輕量級開源DNS服務，跨平臺支持，並有一下幾個特性：
 插件 配置簡單 跨平臺 通用 DNS 方案  官網： [CoreDNS][<a href="https://coredns.io" target="_blank">https://coredns.io</a>]]]></summary>
            
                <content type="html"><![CDATA[<p>CoreDNS是一個由GO語言編寫的輕量級開源DNS服務，跨平臺支持，並有一下幾個特性：</p>

<ul>
<li>插件</li>
<li>配置簡單</li>
<li>跨平臺</li>
<li>通用 DNS 方案</li>
</ul>

<p>官網： [CoreDNS][<a href="https://coredns.io" target="_blank">https://coredns.io</a>]</p>

<h1 id="配置">配置</h1>

<p>在[<a href="https://github.com/coredns/coredns/releases][https://github.com/coredns/coredns/releases]下載最新的pre-built版本" target="_blank">https://github.com/coredns/coredns/releases][https://github.com/coredns/coredns/releases]下載最新的pre-built版本</a></p>

<h3 id="自行編譯">自行編譯</h3>

<p>如果你需要用到<code>Proxy</code>這個plugin的話，你需要自行編譯一份CoreDNS，具體原因參見[ISSUE #3234][<a href="https://github.com/coredns/coredns/issues/3234],編譯十分的簡單，但是網路環境的原因，推薦使用境外服務器編譯,但是當然，你要是相信國內的鏡像，我也不會攔着你" target="_blank">https://github.com/coredns/coredns/issues/3234],編譯十分的簡單，但是網路環境的原因，推薦使用境外服務器編譯,但是當然，你要是相信國內的鏡像，我也不會攔着你</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">git clone https://github.com/coredns/coredns
<span class="nb">cd</span> coredns
make</code></pre></td></tr></table>
</div>
</div>
<p>在<code>make</code>之前，請編輯位於文件夾內的<code>plugin.cfg</code>文件，添加</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">proxy:github.com/coredns/proxy</pre></td></tr></table>
</div>
</div>
<h1 id="corefile">Corefile</h1>

<p>CoreDNS使用Corefile作爲配置文件（和Caddyfile類似），[官方的Manual][<a href="https://coredns.io/manual/toc/#configuration]是這麼說的" target="_blank">https://coredns.io/manual/toc/#configuration]是這麼說的</a></p>

<p><strong>That file consists of one or more Server Blocks. Each Server Block lists one or more Plugins. Those Plugins may be further configured with Directives.</strong></p>

<p>在這裏就廢話不多，需要其他的配置請參考Manual</p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Clash 透明代理</title>
            <link rel="alternate" type="text/html" href="https://example.com/posts/clash-gateway/" />
            <id>https://example.com/posts/clash-gateway/</id>
            <updated>2019-11-16T17:35:04+08:00</updated>
            <published>2019-09-19T19:11:26+08:00</published>
            <author>
                    <name>reuixiy</name>
                    <uri>https://io-oi.me/</uri>
                    <email>reuixiy@gmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</rights><summary type="html"><![CDATA[水文一篇，因爲家裏的網絡中有類似小米盒子，Apple TV這樣的設備，自身配置不是很好，鏈接效率會被降低，還不如在RPi 3B配置一個透明代理 我本來的設想是v2ray + iptables + dnsmasq，然後突然想到Clash自帶了一個簡單的DNS以及透明代理功能，再加上CoreDNS岂不是美滋滋？最后配合ROS指定的ip走透明代理，還要什麼自行車？]]></summary>
            
                <content type="html"><![CDATA[<p>水文一篇，因爲家裏的網絡中有類似小米盒子，Apple TV這樣的設備，自身配置不是很好，鏈接效率會被降低，還不如在RPi 3B配置一個透明代理
我本來的設想是v2ray + iptables + dnsmasq，然後突然想到Clash自帶了一個簡單的DNS以及透明代理功能，再加上CoreDNS岂不是美滋滋？最后配合ROS指定的ip走透明代理，還要什麼自行車？</p>

<h1 id="環境">環境</h1>

<p>需要準備的包,以apt为例</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">sudo apt-get install supervisor iptables-persistent net-tools curl wget vim  -y</code></pre></td></tr></table>
</div>
</div>
<p>開啓轉發</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">echo</span> <span class="s2">&#34;net.ipv6.conf.all.forwarding = 1&#34;</span> &gt;&gt; /etc/sysctl.conf <span class="o">&amp;&amp;</span> sysctl -p</code></pre></td></tr></table>
</div>
</div>
<h1 id="clash配置">Clash配置</h1>

<p>隨便找一個目錄，cd進入
在<a href="https://github.com/Dreamacro/clash/releases/" target="_blank">Clash的Release頁面</a>找到你需要的版本，</p>

<p>樹莓派3B的話是<strong>clash-linux-armv6</strong></p>

<p>笔记本的话是<strong>amd64</strong></p>

<p>我最終還是換成了Thinkpad X201t作爲網關</p>

<p>wget到本地，其實也可以下載到電腦再sftp上來，節約時間（github日常抽風）
如果電腦上已經有Clash，可以同時將<strong>Country.mmdb</strong>上傳，這樣clash就不需要重新下載了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">gzip -d clash-linux-armv6-v0.15.0.gz
mv clash-linux-armv6-v0.15.0 clash-linux
chmod +x clash-linux</code></pre></td></tr></table>
</div>
</div>
<p>在該目錄下創建一個名爲<strong>config.yaml</strong>的配置文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="err">port:</span> <span class="mi">8001</span>
<span class="err">socks-port:</span> <span class="mi">1081</span>
<span class="err">redir-port:</span> <span class="mi">9280</span>
<span class="err">allow-lan:</span> <span class="kc">true</span>
<span class="err">mode:</span> <span class="err">Rule</span>
<span class="err">log-level:</span> <span class="err">info</span>
<span class="err">external-controller:</span> <span class="mf">127.0</span><span class="err">.</span><span class="mf">0.1</span><span class="err">:</span><span class="mi">9090</span>
<span class="err">secret:</span> <span class="s2">&#34;&#34;</span>

<span class="err">dns:</span>
  <span class="err">enable:</span> <span class="kc">true</span>
  <span class="err">ipv</span><span class="mi">6</span><span class="err">:</span> <span class="kc">false</span>
  <span class="err">listen:</span> <span class="mf">0.0</span><span class="err">.</span><span class="mf">0.0</span><span class="err">:</span><span class="mi">53</span>
  <span class="err">enhanced-mode:</span> <span class="err">redir-host</span>
  <span class="err">nameserver:</span>
      <span class="err">-</span> <span class="err">tls://dns.rubyfish.cn:</span><span class="mi">853</span>
  <span class="err">fallback:</span>
      <span class="err">-</span> <span class="err">tls://</span><span class="mf">1.1</span><span class="err">.</span><span class="mf">1.1</span><span class="err">:</span><span class="mi">853</span>
      <span class="err">-</span> <span class="err">tls://dns.google</span>

<span class="err">Proxy:</span>
<span class="err">#</span> <span class="err">shadowsocks</span>
<span class="err">-</span> <span class="p">{</span> <span class="err">name:</span> <span class="nt">&#34;SS&#34;</span><span class="p">,</span> <span class="err">type:</span> <span class="err">ss,</span> <span class="err">server:</span> <span class="nt">&#34;地址&#34;</span><span class="p">,</span> <span class="err">port:</span> <span class="err">端口,</span> <span class="err">cipher:</span> <span class="err">AEAD_CHACHA20_POLY1305,</span> <span class="err">password:</span> <span class="nt">&#34;密碼&#34;</span> <span class="p">}</span>

<span class="err">#</span> <span class="err">vmess</span>
<span class="err">-</span> <span class="p">{</span> <span class="err">name:</span> <span class="nt">&#34;HK&#34;</span><span class="p">,</span> <span class="err">type:</span> <span class="err">vmess,</span> <span class="err">server:</span> <span class="err">地址,</span> <span class="err">port:</span> <span class="err">端口,</span> <span class="err">uuid:</span> <span class="err">你的uuid,</span> <span class="err">alterId:</span> <span class="err">16,</span> <span class="err">cipher:</span> <span class="err">auto,</span> <span class="err">network:</span> <span class="err">ws,</span> <span class="err">ws-path:</span> <span class="err">ws目錄,</span> <span class="err">tls:</span> <span class="err">true,</span> <span class="err">skip-cert-verify:</span> <span class="err">true</span> <span class="p">}</span>

<span class="err">Proxy</span> <span class="err">Group:</span>
<span class="err">-</span> <span class="p">{</span> <span class="err">name:</span> <span class="nt">&#34;Proxy&#34;</span><span class="p">,</span> <span class="err">type:</span> <span class="err">select,</span> <span class="err">proxies:</span> <span class="err">[</span><span class="nt">&#34;HK&#34;</span><span class="err">]</span> <span class="p">}</span>

<span class="err">Rule:</span>
<span class="err">#</span> <span class="err">LAN</span>
<span class="err">-</span> <span class="err">DOMAIN-SUFFIX,local,DIRECT</span>
<span class="err">-</span> <span class="err">IP-CIDR,</span><span class="mf">127.0</span><span class="err">.</span><span class="mf">0.0</span><span class="err">/</span><span class="mi">8</span><span class="err">,DIRECT</span>
<span class="err">-</span> <span class="err">IP-CIDR,</span><span class="mf">172.16</span><span class="err">.</span><span class="mf">0.0</span><span class="err">/</span><span class="mi">12</span><span class="err">,DIRECT</span>
<span class="err">-</span> <span class="err">IP-CIDR,</span><span class="mf">192.168</span><span class="err">.</span><span class="mf">0.0</span><span class="err">/</span><span class="mi">16</span><span class="err">,DIRECT</span>
<span class="err">-</span> <span class="err">IP-CIDR,</span><span class="mf">10.0</span><span class="err">.</span><span class="mf">0.0</span><span class="err">/</span><span class="mi">8</span><span class="err">,DIRECT</span>
<span class="err">-</span> <span class="err">IP-CIDR,</span><span class="mf">17.0</span><span class="err">.</span><span class="mf">0.0</span><span class="err">/</span><span class="mi">8</span><span class="err">,DIRECT</span>
<span class="err">-</span> <span class="err">IP-CIDR,</span><span class="mf">100.64</span><span class="err">.</span><span class="mf">0.0</span><span class="err">/</span><span class="mi">10</span><span class="err">,DIRECT</span>

<span class="err">#</span> <span class="err">Final</span>
<span class="err">-</span> <span class="err">GEOIP,CN,DIRECT</span>
<span class="err">-</span> <span class="err">MATCH,Proxy</span></code></pre></td></tr></table>
</div>
</div>
<p>注意：</p>

<ol>
<li>必須配置<code>redir-port</code>因爲你要做透明代理</li>
<li>DNS那裏配置<strong>監聽和enhanced-mode</strong></li>
<li>開啓Allow Lan並開放對應防火牆</li>
</ol>

<p>我配置的dns都是支持DoT的DNS服務器，國內的選擇紅魚，國外選擇CF，具體Clash請求DNS原理請參考Github頁面</p>

<h1 id="coredns">CoreDNS</h1>

<p>参考文章 <a href="link-to-coredns" target="_blank">CoreDNS配置</a></p>

<p>CoreDNS需要开在高端口，或者修改iptables</p>

<p>请将上面的配置文件中的dns部分改为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="err">dns:</span>
  <span class="err">enable:</span> <span class="kc">true</span>
  <span class="err">ipv</span><span class="mi">6</span><span class="err">:</span> <span class="kc">false</span>
  <span class="err">listen:</span> <span class="mf">0.0</span><span class="err">.</span><span class="mf">0.0</span><span class="err">:</span><span class="mi">53</span>
  <span class="err">enhanced-mode:</span> <span class="err">redir-host</span>
  <span class="err">nameserver:</span>
      <span class="err">-</span> <span class="mf">127.0</span><span class="err">.</span><span class="mf">0.1</span><span class="err">:你的Coredns端口</span></code></pre></td></tr></table>
</div>
</div>
<h1 id="iptables配置">iPtables配置</h1>

<p>我的本地網段是192.168.88.0/16</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></pre></td>
<td class="lntd">
<pre class="chroma">iptables -t nat -N Clash
//創建名爲Clash的規則
iptables -t nat -A Clash -d 192.168.88.0/16 -j RETURN
//不對本地進行代理
iptables -t nat -A Clash -p tcp -j REDIRECT --to-ports 9280
//這裏是你的redirport
iptables -t nat -A PREROUTING -p tcp -j Clash</pre></td></tr></table>
</div>
</div>
<p>然後<code>netfilter-persistent save</code>持久化</p>

<p>之後你就可以愉快的開啓Clash了
<code>./clash-linux -d .</code>
沒有Country.MMDB會自動下載，沒有報錯的話就說明配置完成了
可以把設備的DNS和Gateway都改成樹莓派的ip測試一下</p>

<h3 id="守護進程">守護進程</h3>

<h4 id="supervisor">Supervisor</h4>

<p>新建一個supervisor配置
<code>vim /etc/supervisor/conf.d/clash.conf</code>
內容如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></pre></td>
<td class="lntd">
<pre class="chroma">[supervisord]
nodaemon=false

[program:clash]
priority=1
directory=clash所在的目錄
command=clash所在的目錄/clash-linux -d .
autorestart=true</pre></td></tr></table>
</div>
</div>
<h4 id="pm2">PM2</h4>

<p>官方推荐的进程管理器，十分的方便，安裝需要npm，天朝網路出口常年故障，能不能裝上隨緣</p>

<p>項目地址：  [github.com/Unitech/pm2][<a href="https://github.com/Unitech/pm2" target="_blank">https://github.com/Unitech/pm2</a>]</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">//安裝pm2
npm install pm2 -g
//啓動程序
pm2 start app.js
//查看正在運行的程序
pm2 list
//查看日誌
pm2 logs</code></pre></td></tr></table>
</div>
</div>
<h1 id="ros指定ip走透明代理">ROS指定ip走透明代理</h1>

<p>這部分的話參考<a href="http://www.myxzy.com/post-461.html" target="_blank">RouterOS指定内网IP走指定接口</a>
因爲不想改變現有的網絡結構，所以只讓指定的內網ip走樹莓派
在RouterOS中
IP - Firewall 中切換 Mangle 選項，添加一條新的規則
General 选项卡中，Chain 选择 prerouting ，Src.Address 寫小米盒子等需要代理的ip
如只需要特定协议通过指定接口就需要在protocol中选择对应的协议，全局则不选
Action 选项卡，在 Action 下拉菜单中选择 mark routing ，New Routing Mark 中填入该路由标记名称，Proxy_to_pi
如果多個設備的話，可以考慮配置個adress list，我暫時只有1個，就懶得啦
之後在IP - Routes配置路由，添加一條新的規則</p>

<p>但是我個人更加推薦全局應用，將dns和網關全部更改爲Clash的ip地址</p>

<h1 id="參考文章">參考文章</h1>

<p><a href="http://www.myxzy.com/post-461.html" target="_blank">RouterOS指定内网IP走指定接口</a></p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">Caddy/Nginx &#43; V2Ray</title>
            <link rel="alternate" type="text/html" href="https://example.com/posts/v2ray-ws/" />
            <id>https://example.com/posts/v2ray-ws/</id>
            <updated>2019-11-16T17:35:20+08:00</updated>
            <published>2019-09-15T13:37:25+08:00</published>
            <author>
                    <name>reuixiy</name>
                    <uri>https://io-oi.me/</uri>
                    <email>reuixiy@gmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</rights><summary type="html"><![CDATA[相比較於之前的Nginx，Caddy是一個更加輕量級，安裝更加方便，配置超級簡單的web server，並且支持自動申請lets encrypt證書（雖然我用不到） Caddy配置十分的簡單，幾分鐘即可以完成配置]]></summary>
            
                <content type="html"><![CDATA[<p>相比較於之前的Nginx，Caddy是一個更加輕量級，安裝更加方便，配置超級簡單的web server，並且支持自動申請lets encrypt證書（雖然我用不到）
Caddy配置十分的簡單，幾分鐘即可以完成配置</p>

<h1 id="caddy">Caddy</h1>

<h3 id="下載安裝">下載安裝</h3>

<p><a href="https://caddyserver.com/download" target="_blank">Caddy官網</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">curl https://getcaddy.com <span class="p">|</span> bash -s personal http.forwardproxy,http.proxyprotocol</code></pre></td></tr></table>
</div>
</div>
<p>CentOS的話請輸入一下命令</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">curl -s https://raw.githubusercontent.com/GEM7/My_scripts/master/caddy/caddy.service -o /etc/systemd/system/caddy.service</code></pre></td></tr></table>
</div>
</div>
<h3 id="配置">配置</h3>

<p>配置真心超級簡單，如果需要使用自己的證書，比如CF的證書，請將證書和私鑰保存本地，在配置文件中引用即可。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="err">你的域名:</span><span class="mi">443</span> <span class="p">{</span>
    <span class="err">root</span> <span class="err">/www</span>
    <span class="err">gzip</span>
    <span class="err">index</span> <span class="err">index.html</span>
    <span class="err">tls</span> <span class="err">證書路徑</span> <span class="err">私鑰路徑</span>
    <span class="err">//如果需要自動申請的話，請移除上面這行</span>
    <span class="err">proxy</span> <span class="err">僞裝路徑</span> <span class="err">localhost:9999</span> <span class="err">{</span>
           <span class="err">websocket</span>
           <span class="err">header_upstream</span> <span class="err">-Origin</span>
    <span class="p">}</span>
<span class="err">}</span></code></pre></td></tr></table>
</div>
</div>
<h1 id="nginx">Nginx</h1>

<p>我之前使用是Nginx，但是由於體積大，配置複雜所以選用Caddy，但是這裏還是附上Nginx配置，僅供參考</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">server
<span class="o">{</span>
    listen <span class="m">80</span><span class="p">;</span>
    listen <span class="m">443</span> ssl http2<span class="p">;</span>
    server_name 你的域名 *.你的域名<span class="p">;</span>
    index index.php index.html index.htm default.php default.htm default.html<span class="p">;</span>
    root /www/wwwroot/你的域名<span class="p">;</span>
    
    <span class="c1">#SSL-START SSL相关配置，请勿删除或修改下一行带注释的404规则</span>
    <span class="c1">#error_page 404/404.html;</span>
    <span class="c1">#HTTP_TO_HTTPS_START</span>
    <span class="k">if</span> <span class="o">(</span><span class="nv">$server_port</span> !~ <span class="m">443</span><span class="o">){</span>
        rewrite ^<span class="o">(</span>/.*<span class="o">)</span>$ https://<span class="nv">$host$1</span> permanent<span class="p">;</span>
    <span class="o">}</span>
    <span class="c1">#HTTP_TO_HTTPS_END</span>
    ssl_certificate    /etc/letsencrypt/live/你的域名/fullchain.pem<span class="p">;</span>
    ssl_certificate_key    /etc/letsencrypt/live/你的域名/privkey.pem<span class="p">;</span>
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2<span class="p">;</span>
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE<span class="p">;</span>
    ssl_prefer_server_ciphers on<span class="p">;</span>
    ssl_session_cache shared:SSL:10m<span class="p">;</span>
    ssl_session_timeout 10m<span class="p">;</span>
    error_page <span class="m">497</span>  https://<span class="nv">$host$request_uri</span><span class="p">;</span>

    <span class="c1">#SSL-END</span>
    
    <span class="c1">#ERROR-PAGE-START  错误页配置，可以注释、删除或修改</span>
    error_page <span class="m">404</span> /404.html<span class="p">;</span>
    error_page <span class="m">502</span> /502.html<span class="p">;</span>
    <span class="c1">#ERROR-PAGE-END</span>
    
    <span class="c1">#PHP-INFO-START  PHP引用配置，可以注释或修改</span>
    include enable-php-72.conf<span class="p">;</span>
    <span class="c1">#PHP-INFO-END</span>
    
    <span class="c1">#REWRITE-START URL重写规则引用,修改后将导致面板设置的伪静态规则失效</span>
    include /www/server/panel/vhost/rewrite/你的域名.conf<span class="p">;</span>
    <span class="c1">#REWRITE-END</span>
    
    <span class="c1">#禁止访问的文件或目录</span>
    location ~ ^/<span class="o">(</span><span class="se">\.</span>user.ini<span class="p">|</span><span class="se">\.</span>htaccess<span class="p">|</span><span class="se">\.</span>git<span class="p">|</span><span class="se">\.</span>svn<span class="p">|</span><span class="se">\.</span>project<span class="p">|</span>LICENSE<span class="p">|</span>README.md<span class="o">)</span>
    <span class="o">{</span>
        <span class="k">return</span> <span class="m">404</span><span class="p">;</span>
    <span class="o">}</span>
    
    <span class="c1">#一键申请SSL证书验证目录相关设置</span>
    location ~ <span class="se">\.</span>well-known<span class="o">{</span>
        allow all<span class="p">;</span>
    <span class="o">}</span>
    
    location ~ .*<span class="se">\.</span><span class="o">(</span>gif<span class="p">|</span>jpg<span class="p">|</span>jpeg<span class="p">|</span>png<span class="p">|</span>bmp<span class="p">|</span>swf<span class="o">)</span>$
    <span class="o">{</span>
        expires      30d<span class="p">;</span>
        error_log off<span class="p">;</span>
        access_log off<span class="p">;</span>
    <span class="o">}</span>
    
    location ~ .*<span class="se">\.</span><span class="o">(</span>js<span class="p">|</span>css<span class="o">)</span>?$
    <span class="o">{</span>
        expires      12h<span class="p">;</span>
        error_log off<span class="p">;</span>
        access_log off<span class="p">;</span> 
    <span class="o">}</span>
    access_log  /www/wwwlogs/你的域名.log<span class="p">;</span>
    error_log  /www/wwwlogs/你的域名.error.log<span class="p">;</span>
             location /ws/ <span class="o">{</span>   
             proxy_redirect off<span class="p">;</span>
             proxy_pass http://127.0.0.1:你的端口<span class="p">;</span> 
             proxy_http_version <span class="m">1</span>.1<span class="p">;</span>
             proxy_set_header Upgrade <span class="nv">$http_upgrade</span><span class="p">;</span>
             proxy_set_header Connection <span class="s2">&#34;upgrade&#34;</span><span class="p">;</span>
             proxy_set_header Host <span class="nv">$http_host</span><span class="p">;</span>            
          <span class="o">}</span>
<span class="o">}</span></code></pre></td></tr></table>
</div>
</div>
<p>證書申請之類的請自行參考使用<strong>acme.sh</strong></p>

<h3 id="websocket解決bad-request">WebSocket解決Bad Request</h3>

<p>轉自<a href="https://www.ivyseeds.cf/websockets2/" target="_blank">从零开始安装爱国工具指南（十四）V2Ray补充、WebSockets模式补完</a></p>

<h4 id="修改nginx-conf">修改nginx.conf</h4>

<p>文件位<code>于/usr/local/nginx/conf/</code></p>

<p>在代码<code>http{}</code>段里添加一句</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">proxy_intercept_errors on;</pre></td></tr></table>
</div>
</div>
<p>保存退出即可</p>

<h4 id="修改vhost文件">修改vhost文件</h4>

<p>文件位于<code>/usr/local/nginx/conf/vhost/</code></p>

<p>在443端口的配置里加一句，比如說我跳轉回到<a href="https://mrsheep.win" target="_blank">mrsheep.win</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">error_page 400 = https://www.mrsheep.win;</pre></td></tr></table>
</div>
</div>
<p>保存退出重启nginx</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">service nginx restart</pre></td></tr></table>
</div>
</div>
<h1 id="v2ray">V2Ray</h1>

<h2 id="安裝">安裝</h2>

<h3 id="官方安裝">官方安裝</h3>

<p><strong>如果你想要使用管理腳本等，請直接跳過本節</strong>
使用官方安裝腳本: <a href="https://www.v2ray.com/chapter_00/install.html#linuxscript" target="_blank">www.v2ray.com/chapter_00/install.html#linuxscript</a>
<strong>請使用root用戶運行一下腳本</strong>
运行下面的指令下载并安装  V2Ray。当 yum 或 apt-get 可用的情况下，此脚本会自动安装 unzip 和 daemon。这两个组件是安装 V2Ray  的必要组件。如果你使用的系统不支持 yum 或 apt-get，请自行安装 unzip 和 daemon</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">bash &lt;<span class="o">(</span>curl -L -s https://install.direct/go.sh<span class="o">)</span></code></pre></td></tr></table>
</div>
</div>
<p><strong>此脚本会自动安装以下文件：</strong></p>

<p><code>/usr/bin/v2ray/v2ray</code>：V2Ray 程序；
<code>/usr/bin/v2ray/v2ctl</code>：V2Ray 工具；
<code>/etc/v2ray/config.json</code>：配置文件；
<code>/usr/bin/v2ray/geoip.dat</code>：IP 数据文件
<code>/usr/bin/v2ray/geosite.dat</code>：域名数据文件
配置<code>/etc/v2ray/config.json</code>即可</p>

<h3 id="腳本">腳本</h3>

<p>這裏僅僅使用Multi-V2Ray，其他的請自行參考對應wiki</p>

<h4 id="multi-v2ray">Multi-V2Ray</h4>

<p>項目地址：<a href="https://github.com/Jrohy/multi-v2ray" target="_blank">https://github.com/Jrohy/multi-v2ray</a>
運行命令安裝，</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">source</span> &lt;<span class="o">(</span>curl -sL https://git.io/fNgqx<span class="o">)</span></code></pre></td></tr></table>
</div>
</div>
<p>部分VPS安裝完成之後提示找不到v2ray命令，請運行<code>/usr/local/multi-v2ray/v2ray</code></p>

<h5 id="命令行參數">命令行參數：</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">   v2ray -h                   查看帮助
   v2ray -v                   查看版本信息
   v2ray start                启动 V2Ray
   v2ray stop                 停止 V2Ray
   v2ray restart              重启 V2Ray
   v2ray status               查看 V2Ray 运行状态
   v2ray log                  查看 V2Ray 运行日志
   v2ray update               更新 V2Ray 到最新Release版本
   v2ray update <span class="o">[</span>version<span class="o">]</span>     更新 V2Ray 到特定版本
   v2ray update.sh            更新 multi-v2ray 脚本
   v2ray update.sh <span class="o">[</span>version<span class="o">]</span>  更新 multi-v2ray 到特定版本
   v2ray add                  新增mkcp + 随机一种 <span class="o">(</span>srtp <span class="p">|</span> wechat-video <span class="p">|</span> utp<span class="o">)</span> header伪装的端口<span class="o">(</span>Group<span class="o">)</span>
   v2ray add <span class="o">[</span>wechat<span class="p">|</span>utp<span class="p">|</span>srtp<span class="p">|</span>dtls<span class="p">|</span>wireguard<span class="p">|</span>socks<span class="p">|</span>mtproto<span class="p">|</span>ss<span class="o">]</span>     新增一种协议的组，端口随机,如 v2ray add utp 为新增utp协议
   v2ray del                  删除端口组
   v2ray info                 查看配置
   v2ray port                 修改端口
   v2ray tls                  修改tls
   v2ray tfo                  修改tcpFastOpen
   v2ray stream               修改传输协议
   v2ray stats                iptables流量统计
   v2ray clean                清理日志</code></pre></td></tr></table>
</div>
</div>
<p>更多請參考: <a href="https://github.com/Jrohy/multi-v2ray/wiki" target="_blank">https://github.com/Jrohy/multi-v2ray/wiki</a></p>

<h2 id="配置-1">配置</h2>

<h3 id="tls">TLS</h3>

<p>證書的話可以直接使用Caddy自動申請Let‘s Encrypt的證書，3個月續命一次即可</p>

<p>其他的話如使用Cloudflare簽發的證書，請參考上面 [Caddy配置][配置]</p>

<h3 id="dns">DNS</h3>

<p><strong>推荐的DNS服务商（免费）：Geoscaling，Cloudflare（仅使用DNS）</strong>
不建议使用国内解析服务，VPS提供的DNS服务（例如Conoha的DNS解析）</p>

<h3 id="bbr">BBR</h3>

<h4 id="換核">換核</h4>

<p>如果你不需要，請直接跳過</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">//导入key
rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
//安装 elrepo 的yum源
rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm
//安装内核
yum --enablerepo<span class="o">=</span>elrepo-kernel install kernel-ml-devel kernel-ml -y
//查看系统启动项：
cat /boot/grub2/grub.cfg <span class="p">|</span>grep menuentry
//设置最新版本内核为默认启动：
grub2-set-default <span class="err">&#39;</span>最新的內核，如CentOS Linux <span class="o">(</span><span class="m">4</span>.8.5-1.el7.elrepo.x86_64<span class="o">)</span> <span class="m">7</span> <span class="o">(</span>Core<span class="o">)</span></code></pre></td></tr></table>
</div>
</div>
<p><strong>注：請一定等待安裝完成</strong></p>

<p>此时，查看默认启动的系统版本</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">grub2-editenv list</code></pre></td></tr></table>
</div>
</div>
<p>显示为&rsquo;CentOS Linux (4.8.5-1.el7.elrepo.x86_64) 7 (Core)&lsquo;或類似，reboot之后再次查看 <code>uname -r</code></p>

<h4 id="開啓bbr">開啓BBR</h4>

<p>複製如下命令即可</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">cat &gt;&gt;/etc/sysctl.conf <span class="s">&lt;&lt; EOF
</span><span class="s">net.core.default_qdisc=fq
</span><span class="s">net.ipv4.tcp_congestion_control=bbr
</span><span class="s">EOF</span></code></pre></td></tr></table>
</div>
</div>
<p>再继续内核参数：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">sysctl -p</pre></td></tr></table>
</div>
</div>
<p>返回類似結果</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span><span class="lnt">2
</span></pre></td>
<td class="lntd">
<pre class="chroma">net.core.default_qdisc = fq
net.ipv4.tcp_congestion_control = bbr</pre></td></tr></table>
</div>
</div>
<p>最后保险起见，复核一下BBR是否生效：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></pre></td>
<td class="lntd">
<pre class="chroma">sysctl net.ipv4.tcp_available_congestion_control

lsmod | grep bbr</pre></td></tr></table>
</div>
</div>
<p>返回類似</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></pre></td>
<td class="lntd">
<pre class="chroma">net.ipv4.tcp_available_congestion_control = reno cubic bbr

tcp_bbr                20480  41 </pre></td></tr></table>
</div>
</div>
<h4 id="cdn">CDN</h4>

<p>個人不需要套CDN，當前地區封鎖不嚴重</p>

<h4 id="配置模板">配置模板</h4>

<p>我的部分配置可以參考</p>

<h5 id="服務端">服務端</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;inbound&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;streamSettings&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;network&#34;</span><span class="p">:</span> <span class="s2">&#34;ws&#34;</span><span class="p">,</span> 
      <span class="nt">&#34;wsSettings&#34;</span><span class="p">:</span> <span class="p">{</span> 
        <span class="nt">&#34;headers&#34;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&#34;host&#34;</span><span class="p">:</span> <span class="s2">&#34;你的域名&#34;</span>
        <span class="p">},</span>
      <span class="nt">&#34;path&#34;</span><span class="p">:</span> <span class="s2">&#34;/ws/&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span> 
    <span class="nt">&#34;protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;vmess&#34;</span><span class="p">,</span> 
    <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="err">你的端口</span><span class="p">,</span> 
    <span class="nt">&#34;settings&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;clients&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&#34;alterId&#34;</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span> 
          <span class="nt">&#34;security&#34;</span><span class="p">:</span> <span class="s2">&#34;auto&#34;</span><span class="p">,</span> 
          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;你的uuid&#34;</span><span class="p">,</span> 
          <span class="nt">&#34;level&#34;</span><span class="p">:</span> <span class="mi">1</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">},</span> 
  <span class="nt">&#34;outboundDetour&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;tag&#34;</span><span class="p">:</span> <span class="s2">&#34;blocked&#34;</span><span class="p">,</span> 
      <span class="nt">&#34;protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;blackhole&#34;</span><span class="p">,</span> 
      <span class="nt">&#34;settings&#34;</span><span class="p">:</span> <span class="p">{}</span>
    <span class="p">}</span>
  <span class="p">],</span> 
  <span class="nt">&#34;outbound&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;freedom&#34;</span><span class="p">,</span> 
    <span class="nt">&#34;settings&#34;</span><span class="p">:</span> <span class="p">{}</span>
  <span class="p">},</span> 
  <span class="nt">&#34;log&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;access&#34;</span><span class="p">:</span> <span class="s2">&#34;/var/log/v2ray/access.log&#34;</span><span class="p">,</span> 
    <span class="nt">&#34;loglevel&#34;</span><span class="p">:</span> <span class="s2">&#34;info&#34;</span><span class="p">,</span> 
    <span class="nt">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;/var/log/v2ray/error.log&#34;</span>
  <span class="p">},</span> 
  <span class="nt">&#34;routing&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;settings&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;rules&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&#34;ip&#34;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&#34;0.0.0.0/8&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;10.0.0.0/8&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;100.64.0.0/10&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;127.0.0.0/8&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;169.254.0.0/16&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;172.16.0.0/12&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;192.0.0.0/24&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;192.0.2.0/24&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;192.168.0.0/16&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;198.18.0.0/15&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;198.51.100.0/24&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;203.0.113.0/24&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;::1/128&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;fc00::/7&#34;</span><span class="p">,</span> 
            <span class="s2">&#34;fe80::/10&#34;</span>
          <span class="p">],</span> 
          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;field&#34;</span><span class="p">,</span> 
          <span class="nt">&#34;outboundTag&#34;</span><span class="p">:</span> <span class="s2">&#34;blocked&#34;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span> 
    <span class="nt">&#34;strategy&#34;</span><span class="p">:</span> <span class="s2">&#34;rules&#34;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<h5 id="客戶端">客戶端</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;policy&#34;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;levels&#34;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;0&#34;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;uplinkOnly&#34;</span> <span class="p">:</span> <span class="mi">0</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&#34;dns&#34;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;servers&#34;</span> <span class="p">:</span> <span class="p">[</span>
      <span class="s2">&#34;localhost&#34;</span><span class="p">,</span>
      <span class="s2">&#34;8.8.8.8&#34;</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="nt">&#34;outboundDetour&#34;</span> <span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;protocol&#34;</span> <span class="p">:</span> <span class="s2">&#34;freedom&#34;</span><span class="p">,</span>
      <span class="nt">&#34;tag&#34;</span> <span class="p">:</span> <span class="s2">&#34;direct&#34;</span><span class="p">,</span>
      <span class="nt">&#34;settings&#34;</span> <span class="p">:</span> <span class="p">{</span>

      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&#34;inbound&#34;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;listen&#34;</span> <span class="p">:</span> <span class="s2">&#34;0.0.0.0&#34;</span><span class="p">,</span>
    <span class="nt">&#34;port&#34;</span> <span class="p">:</span> <span class="mi">1081</span><span class="p">,</span>
    <span class="nt">&#34;protocol&#34;</span> <span class="p">:</span> <span class="s2">&#34;socks&#34;</span><span class="p">,</span>
    <span class="nt">&#34;settings&#34;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;auth&#34;</span> <span class="p">:</span> <span class="s2">&#34;noauth&#34;</span><span class="p">,</span>
      <span class="nt">&#34;udp&#34;</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nt">&#34;ip&#34;</span> <span class="p">:</span> <span class="s2">&#34;127.0.0.1&#34;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&#34;inboundDetour&#34;</span> <span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;listen&#34;</span> <span class="p">:</span> <span class="s2">&#34;0.0.0.0&#34;</span><span class="p">,</span>
      <span class="nt">&#34;allocate&#34;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;strategy&#34;</span> <span class="p">:</span> <span class="s2">&#34;always&#34;</span><span class="p">,</span>
        <span class="nt">&#34;refresh&#34;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="nt">&#34;concurrency&#34;</span> <span class="p">:</span> <span class="mi">3</span>
      <span class="p">},</span>
      <span class="nt">&#34;port&#34;</span> <span class="p">:</span> <span class="mi">8001</span><span class="p">,</span>
      <span class="nt">&#34;protocol&#34;</span> <span class="p">:</span> <span class="s2">&#34;http&#34;</span><span class="p">,</span>
      <span class="nt">&#34;tag&#34;</span> <span class="p">:</span> <span class="s2">&#34;httpDetour&#34;</span><span class="p">,</span>
      <span class="nt">&#34;domainOverride&#34;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="s2">&#34;http&#34;</span><span class="p">,</span>
        <span class="s2">&#34;tls&#34;</span>
      <span class="p">],</span>
      <span class="nt">&#34;streamSettings&#34;</span> <span class="p">:</span> <span class="p">{</span>

      <span class="p">},</span>
      <span class="nt">&#34;settings&#34;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;timeout&#34;</span> <span class="p">:</span> <span class="mi">0</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&#34;log&#34;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;error&#34;</span> <span class="p">:</span> <span class="s2">&#34;\/var\/folders\/jt\/dc88j3317917cz1n8mxqj8jc0000gn\/T\/cenmrev.v2rayx.log.C2EAD579-EFCE-4BEC-91A2-61E4760E1219\/error.log&#34;</span><span class="p">,</span>
    <span class="nt">&#34;loglevel&#34;</span> <span class="p">:</span> <span class="s2">&#34;debug&#34;</span><span class="p">,</span>
    <span class="nt">&#34;access&#34;</span> <span class="p">:</span> <span class="s2">&#34;\/var\/folders\/jt\/dc88j3317917cz1n8mxqj8jc0000gn\/T\/cenmrev.v2rayx.log.C2EAD579-EFCE-4BEC-91A2-61E4760E1219\/access.log&#34;</span>
  <span class="p">},</span>
  <span class="nt">&#34;routing&#34;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;strategy&#34;</span> <span class="p">:</span> <span class="s2">&#34;rules&#34;</span><span class="p">,</span>
    <span class="nt">&#34;settings&#34;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;domainStrategy&#34;</span> <span class="p">:</span> <span class="s2">&#34;IPIfNonMatch&#34;</span><span class="p">,</span>
      <span class="nt">&#34;rules&#34;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&#34;domain&#34;</span> <span class="p">:</span> <span class="p">[</span>
            <span class="s2">&#34;localhost&#34;</span>
          <span class="p">],</span>
          <span class="nt">&#34;type&#34;</span> <span class="p">:</span> <span class="s2">&#34;field&#34;</span><span class="p">,</span>
          <span class="nt">&#34;outboundTag&#34;</span> <span class="p">:</span> <span class="s2">&#34;direct&#34;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&#34;type&#34;</span> <span class="p">:</span> <span class="s2">&#34;field&#34;</span><span class="p">,</span>
          <span class="nt">&#34;outboundTag&#34;</span> <span class="p">:</span> <span class="s2">&#34;direct&#34;</span><span class="p">,</span>
          <span class="nt">&#34;ip&#34;</span> <span class="p">:</span> <span class="p">[</span>
            <span class="s2">&#34;geoip:private&#34;</span>
          <span class="p">]</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&#34;outbound&#34;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;sendThrough&#34;</span> <span class="p">:</span> <span class="s2">&#34;0.0.0.0&#34;</span><span class="p">,</span>
    <span class="nt">&#34;mux&#34;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;enabled&#34;</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nt">&#34;concurrency&#34;</span> <span class="p">:</span> <span class="mi">8</span>
    <span class="p">},</span>
    <span class="nt">&#34;protocol&#34;</span> <span class="p">:</span> <span class="s2">&#34;vmess&#34;</span><span class="p">,</span>
    <span class="nt">&#34;settings&#34;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;vnext&#34;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&#34;address&#34;</span> <span class="p">:</span> <span class="s2">&#34;你的域名&#34;</span><span class="p">,</span>
          <span class="nt">&#34;port&#34;</span> <span class="p">:</span> <span class="mi">443</span><span class="p">,</span>
          <span class="nt">&#34;users&#34;</span> <span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="nt">&#34;id&#34;</span> <span class="p">:</span> <span class="s2">&#34;你的UUID&#34;</span><span class="p">,</span>
              <span class="nt">&#34;alterId&#34;</span> <span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
              <span class="nt">&#34;security&#34;</span> <span class="p">:</span> <span class="s2">&#34;auto&#34;</span><span class="p">,</span>
              <span class="nt">&#34;level&#34;</span> <span class="p">:</span> <span class="mi">0</span>
            <span class="p">}</span>
          <span class="p">],</span>
          <span class="nt">&#34;remark&#34;</span> <span class="p">:</span> <span class="s2">&#34;這個&#34;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="nt">&#34;streamSettings&#34;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;wsSettings&#34;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;path&#34;</span> <span class="p">:</span> <span class="s2">&#34;\/ws\/&#34;</span><span class="p">,</span><span class="err">你的path</span>
        <span class="nt">&#34;headers&#34;</span> <span class="p">:</span> <span class="p">{</span>
          <span class="nt">&#34;Host&#34;</span> <span class="p">:</span> <span class="s2">&#34;你的域名&#34;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nt">&#34;tlsSettings&#34;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;serverName&#34;</span> <span class="p">:</span> <span class="s2">&#34;你的域名&#34;</span><span class="p">,</span>
        <span class="nt">&#34;allowInsecure&#34;</span> <span class="p">:</span> <span class="kc">false</span>
      <span class="p">},</span>
      <span class="nt">&#34;httpSettings&#34;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;path&#34;</span> <span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
        <span class="nt">&#34;host&#34;</span> <span class="p">:</span> <span class="p">[</span>
          <span class="s2">&#34;&#34;</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="nt">&#34;tcpSettings&#34;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;header&#34;</span> <span class="p">:</span> <span class="p">{</span>
          <span class="nt">&#34;type&#34;</span> <span class="p">:</span> <span class="s2">&#34;none&#34;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nt">&#34;kcpSettings&#34;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;header&#34;</span> <span class="p">:</span> <span class="p">{</span>
          <span class="nt">&#34;type&#34;</span> <span class="p">:</span> <span class="s2">&#34;none&#34;</span>
        <span class="p">},</span>
        <span class="nt">&#34;mtu&#34;</span> <span class="p">:</span> <span class="mi">1350</span><span class="p">,</span>
        <span class="nt">&#34;congestion&#34;</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nt">&#34;tti&#34;</span> <span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="nt">&#34;uplinkCapacity&#34;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="nt">&#34;writeBufferSize&#34;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nt">&#34;readBufferSize&#34;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nt">&#34;downlinkCapacity&#34;</span> <span class="p">:</span> <span class="mi">20</span>
      <span class="p">},</span>
      <span class="nt">&#34;network&#34;</span> <span class="p">:</span> <span class="s2">&#34;ws&#34;</span><span class="p">,</span>
      <span class="nt">&#34;security&#34;</span> <span class="p">:</span> <span class="s2">&#34;tls&#34;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<h1 id="參考鏈接">參考鏈接</h1>

<p><a href="https://www.v2ray.com" target="_blank">V2Ray項目</a></p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">V2Ray Force Ipv4</title>
            <link rel="alternate" type="text/html" href="https://example.com/posts/v2ray-force-ipv4/" />
            <id>https://example.com/posts/v2ray-force-ipv4/</id>
            <updated>2019-11-16T17:35:13+08:00</updated>
            <published>2019-09-15T02:11:05+08:00</published>
            <author>
                    <name>reuixiy</name>
                    <uri>https://io-oi.me/</uri>
                    <email>reuixiy@gmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</rights><summary type="html"><![CDATA[我在机器上开了6to4的隧道，本來是準備用來廣播我自己的ipv6，但是這樣子导致V2Ray流量会被转发到HE的隧道ip，最后NF会直接ban掉HE的ip 所以我不废话了…]]></summary>
            
                <content type="html"><![CDATA[<p>我在机器上开了6to4的隧道，本來是準備用來廣播我自己的ipv6，但是這樣子导致V2Ray流量会被转发到HE的隧道ip，最后NF会直接ban掉HE的ip
所以我不废话了&hellip;</p>

<h1 id="freedom">Freedom</h1>

<p>需要用到的就是Freedom是這個協議，從V2ray官網上有如下解釋：
<strong>Freedom 是一个出站协议，可以用来向任意网络发送（正常的） TCP 或 UDP 数据</strong>
在目标地址为域名时，Freedom 可以直接向此域名发出连接（&rdquo;AsIs&rdquo;），或者将域名解析为 IP 之后再建立连接（&rdquo;UseIP&rdquo;、&rdquo;UseIPv4&rdquo;、&rdquo;UseIPv6&rdquo;）。解析 IP 的步骤会使用 V2Ray 内建的 DNS。默认值为&rdquo;AsIs&rdquo;。</p>

<ol>
<li>(V2Ray 4.6+) 当使用 <strong>&ldquo;UseIP&rdquo;</strong> 模式，并且出站连接配置中指定了sendThrough时，Freedom 会根据sendThrough的值自动判断所需的IP类型，IPv4 或 IPv6。</li>
<li>(V2Ray 4.7+) 当使用 <strong>&ldquo;UseIPv4&rdquo;</strong> 或 <strong>&ldquo;UseIPv6&rdquo;</strong> 模式时，Freedom 会只使用对应的 IPv4 或 IPv6 地址。当sendThrough指定了不匹配的本地地址时，将导致连接失败</li>
</ol>

<p>需要用到這個協議:<a href="https://www.v2ray.com/chapter_02/protocols/freedom.html" target="_blank">V2Ray文檔</a>
關於配置文檔格式:<a href="https://www.v2ray.com/chapter_02/01_overview.html#outboundobject" target="_blank">V2Ray文檔</a></p>

<h1 id="具體配置">具體配置</h1>

<p>一點都不複雜，和本部分沒有關係的都已經去掉</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></pre></td>
<td class="lntd">
<pre class="chroma">  &#34;inbounds&#34;: [
    {
      &#34;port&#34;: 29708,
      &#34;protocol&#34;: &#34;vmess&#34;,
      &#34;settings&#34;:{
        &#34;clients&#34;: [
        {
          &#34;id&#34;: &#34;uuid&#34;,
          &#34;alterId&#34;: 16,
        }
      ]
    },
      &#34;streamSettings&#34;: {
        &#34;network&#34;: &#34;ws&#34;,
        &#34;security&#34;: &#34;auto&#34;,
        &#34;wsSettings&#34;: {
          &#34;path&#34;: &#34;/&#34;,
          &#34;connectionReuse&#34;:true,
          &#34;headers&#34;:{
          }
        },
      &#34;disableInsecureEncryption&#34;: true
    }
  }
],
  &#34;outbound&#34;:{
      &#34;sendThrough&#34;: &#34;0.0.0.0&#34;,
      &#34;protocol&#34;: &#34;freedom&#34;,
      &#34;settings&#34;: {
          &#34;domainStrategy&#34;: &#34;UseIPv4&#34;,
          &#34;userLevel&#34;: 0
      }
    }
}</pre></td></tr></table>
</div>
</div>
<p>其實這又是水文一篇</p>

<h1 id="參考">參考</h1>

<p>V2ray.com</p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">廣播你的ip</title>
            <link rel="alternate" type="text/html" href="https://example.com/posts/broadcast-ip/" />
            <id>https://example.com/posts/broadcast-ip/</id>
            <updated>2019-11-16T17:35:00+08:00</updated>
            <published>2019-09-13T17:47:00+08:00</published>
            <author>
                    <name>reuixiy</name>
                    <uri>https://io-oi.me/</uri>
                    <email>reuixiy@gmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</rights><summary type="html"><![CDATA[我的AS號和IP都已經沾灰了，再不用就要徹底忘了。
在你開始之前，請確定你的ISP 为你分配了一个公网 IPv4, 並且你拥有 ASN 和一个至少为 / 48 的 ipv6 block]]></summary>
            
                <content type="html"><![CDATA[<p>我的AS號和IP都已經沾灰了，再不用就要徹底忘了。</p>

<p>在你開始之前，請確定你的ISP 为你分配了一个公网 IPv4, 並且你拥有 ASN 和一个至少为 / 48 的 ipv6 block</p>

<h1 id="開始之前的一點py交易">開始之前的一點PY交易</h1>

<p>準備Py之前，請確定如下內容(來自HE),不然你去PY也沒有意義</p>

<p><strong>Through this interface you can request a static, IPv6 BGP tunnel that will receive full transit routes from AS6939 and be able to announce your RIR allocated IPv6 space. To minimize any issues or delays in turnup please note the following:
    Your ASN must be allocated from a RIR. (Public ASNs only)
    We must be able to validate that this is your ASN/address space (SWIP entries or a LoA will do)
    We will prefix-filter your BGP session. If you are adding new announcements, please let us know via an email to ipv6@he.net.
    We do not filter traffic. However, we do reserve the right to filter at our sole discretion as needed.
    If this is your first tunnel for this ASN, you should receive a message to your account&rsquo;s email address. Please follow the instructions in the email to complete the verification process. During this period the tunnel and BGP session will be unavailable. If you have not heard from us within 48 hours then please email ipv6@he.net.
    地址：<a href="https://blog.ni-co.moe/public/563.html" target="_blank">tunnelbroker.net</a></strong></p>

<p>然後你就可以去註冊一個帳號，之後创建一个 BGP 隧道，選擇最近的节点，填寫你的ASN以及IP段
最後你需要一封Authorize Letter（LoA）
提交24小時左右PY交易就會成功</p>

<h1 id="創建隧道">創建隧道</h1>

<p>訪問tunnelbroker</p>

<p><code>Tunnel - Example Config - Linux net-tools</code>
配置大概張這個樣子</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ifconfig sit0 up" data-lang="ifconfig sit0 up"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ifconfig sit0 up" data-lang="ifconfig sit0 up">ifconfig sit0 inet6 tunnel ::0.0.0.0
ifconfig sit1 up
ifconfig sit1 inet6 add ::::/64
route -A inet6 add ::/0 dev sit1</code></pre></td></tr></table>
</div>
</div>
<h1 id="廣播">廣播</h1>

<h3 id="安裝bird6">安裝bird6</h3>

<p><code>yum install bird6 -y</code></p>

<h3 id="編輯-etc-bird6-conf">編輯 <code>/etc/bird6.conf</code></h3>

<p>注意：</p>

<ol>
<li>router id請寫本機ip</li>
<li>local as是你的asn</li>
<li>source add是HE給你的client ip</li>

<li><p>neighbor是 HE分配的 server ip,6939 为 he 的 asn 号码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></pre></td>
<td class="lntd">
<pre class="chroma">router id 本機ip;
protocol bgp he{
    local as 208884;
    source address Client_ip;
    import none;
    export all;
    graceful restart on;
    multihop 2;
    neighbor server_ip as 6939;
}
protocol static
{
route  你的ip段 via cleint_ip;
}
protocol device
{
    scan time 5;
}</pre></td></tr></table>
</div>
</div></li>
</ol>

<p>之後保存推出，重載bird配置，或者重啓bird即可
最後<code>birdc6 show proto all</code>
顯示Established即可</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></pre></td>
<td class="lntd">
<pre class="chroma">name     proto    table    state  since       info
he       BGP      master   up     17:40:47    Established   
  Preference:     100
  Input filter:   REJECT
  Output filter:  ACCEPT
  Routes:         0 imported, 1 exported, 0 preferred
  Route change stats:     received   rejected   filtered    ignored   accepted
    Import updates:           3457          0       3457          0          0
    Import withdraws:            0          0        ---       3457          0
    Export updates:              1          0          0        ---          1
    Export withdraws:            0        ---        ---        ---          0
  BGP state:          Established
    Neighbor address: 2001:470:d6:e::1
    Neighbor AS:      6939
    Neighbor ID:      64.71.128.26
    Neighbor caps:    refresh AS4
    Session:          external multihop AS4
    Source address:   2001:470:d6:e::2
    Hold timer:       179/180
    Keepalive timer:  52/60

static1  Static   master   up     17:40:42    
  Preference:     200
  Input filter:   ACCEPT
  Output filter:  REJECT
  Routes:         1 imported, 0 exported, 1 preferred
  Route change stats:     received   rejected   filtered    ignored   accepted
    Import updates:              1          0          0          0          1
    Import withdraws:            0          0        ---          0          0
    Export updates:              0          0          0        ---          0
    Export withdraws:            0        ---        ---        ---          0

device1  Device   master   up     17:40:42    
  Preference:     240
  Input filter:   ACCEPT
  Output filter:  REJECT
  Routes:         0 imported, 0 exported, 0 preferred
  Route change stats:     received   rejected   filtered    ignored   accepted
    Import updates:              0          0          0          0          0
    Import withdraws:            0          0        ---          0          0
    Export updates:              0          0          0        ---          0
    Export withdraws:            0        ---        ---        ---          0</pre></td></tr></table>
</div>
</div>
<h1 id="宣告">宣告</h1>

<p>創建虛擬網卡並分配ip</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></pre></td>
<td class="lntd">
<pre class="chroma">    ip link add dev dummy1 type dummy
    ip link set dummy1 up
    ip addr add dev dummy1 2001:2333:2333::1/128</pre></td></tr></table>
</div>
</div>
<p>編輯<strong>bird6.conf</strong>加入</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-protocol direct" data-lang="protocol direct"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-protocol direct" data-lang="protocol direct">    {
        interface &#34;dummy*&#34;;
        import all;
    }</code></pre></td></tr></table>
</div>
</div>
<p>之後
    service bird6 restart</p>

<p>這樣 bird 將查詢所有 dummy 开头的网卡的 ip 并宣告这些 ip
 <code>birdc6 show route</code> 查看</p>

<h1 id="參考">參考</h1>

<p><a href="https://blog.ni-co.moe/public/563.html" target="_blank">IP 广播：在不借助你的 ISP 进行任何操作的情况下，广播 (组播) 你的 IPv6</a>
<a href="https://blog.ni-co.moe/public/560.html" target="_blank">IP 广播：使用 bird 广播 (组播) ipv6</a></p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
        <entry>
            <title type="text">V2Ray中轉</title>
            <link rel="alternate" type="text/html" href="https://example.com/posts/v2ray-fw/" />
            <id>https://example.com/posts/v2ray-fw/</id>
            <updated>2019-11-16T17:35:15+08:00</updated>
            <published>2019-05-10T16:51:13+08:00</published>
            <author>
                    <name>reuixiy</name>
                    <uri>https://io-oi.me/</uri>
                    <email>reuixiy@gmail.com</email>
                    </author>
            <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</rights><summary type="html"><![CDATA[國內到我HE的小機線路峰值ping偏高，但是ip很清真，剛好我的HK小機的ISP和HE有transit 方案如下
 使用UUID1鏈接中轉服務器，將流量路由到#1服務器 使用UUID2鏈接中轉服務器，將流量路由到#2服務器 使用UUID3鏈接中轉服務器，直接使用當前服務器訪問]]></summary>
            
                <content type="html"><![CDATA[<p>國內到我HE的小機線路峰值ping偏高，但是ip很清真，剛好我的HK小機的ISP和HE有transit
方案如下</p>

<ol>
<li>使用UUID1鏈接中轉服務器，將流量路由到<code>#1</code>服務器</li>
<li>使用UUID2鏈接中轉服務器，將流量路由到<code>#2</code>服務器</li>
<li>使用UUID3鏈接中轉服務器，直接使用當前服務器訪問</li>
</ol>

<h1 id="服務器配置">服務器配置</h1>

<h3 id="末端服務器配置">末端服務器配置</h3>

<p>參考<a href="https://blog.mrsheep.xyz/2019/09/15/WebServer-V2Ray/" target="_blank">Caddy/Nginx + V2Ray</a></p>

<h3 id="中轉服務器">中轉服務器</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json">  <span class="s2">&#34;log&#34;</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">&#34;access&#34;</span><span class="p">:</span> <span class="s2">&#34;/var/log/v2ray/access.log&#34;</span><span class="p">,</span>
    <span class="nt">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;/var/log/v2ray/error.log&#34;</span><span class="p">,</span>
    <span class="nt">&#34;loglevel&#34;</span><span class="p">:</span> <span class="s2">&#34;warnings&#34;</span>
  <span class="p">}</span><span class="err">,</span>
   <span class="s2">&#34;inbounds&#34;</span><span class="err">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="err">端口</span><span class="p">,</span>
      <span class="nt">&#34;protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;vmess&#34;</span><span class="p">,</span>
      <span class="nt">&#34;settings&#34;</span><span class="p">:{</span>
        <span class="nt">&#34;clients&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;UUID1&#34;</span><span class="p">,</span>
          <span class="nt">&#34;alterId&#34;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
          <span class="nt">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;Email1（隨意寫）&#34;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;UUID2&#34;</span><span class="p">,</span>
          <span class="nt">&#34;alterId&#34;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
          <span class="nt">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;Email2（隨意）&#34;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;UUID3&#34;</span><span class="p">,</span>
          <span class="nt">&#34;alterId&#34;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
          <span class="nt">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;Email3（隨意）&#34;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="err">//鏈接中轉服務器的協議爲wss</span>
      <span class="nt">&#34;streamSettings&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;network&#34;</span><span class="p">:</span> <span class="s2">&#34;ws&#34;</span><span class="p">,</span>
        <span class="nt">&#34;security&#34;</span><span class="p">:</span> <span class="s2">&#34;auto&#34;</span><span class="p">,</span>
        <span class="nt">&#34;wsSettings&#34;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&#34;path&#34;</span><span class="p">:</span> <span class="s2">&#34;/你的path/&#34;</span><span class="p">,</span>
          <span class="nt">&#34;connectionReuse&#34;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
          <span class="nt">&#34;headers&#34;</span><span class="p">:{</span>
            <span class="nt">&#34;Host&#34;</span><span class="p">:</span><span class="s2">&#34;域名&#34;</span><span class="p">,</span>
          <span class="p">}</span>
        <span class="p">},</span>
      <span class="nt">&#34;disableInsecureEncryption&#34;</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]</span><span class="err">,</span>
  <span class="s2">&#34;outbound&#34;</span><span class="err">:</span><span class="p">{</span>
  <span class="err">//使用UUID3，不進行中轉</span>
      <span class="nt">&#34;protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;freedom&#34;</span><span class="p">,</span>
      <span class="nt">&#34;settings&#34;</span><span class="p">:</span> <span class="p">{}</span>
    <span class="p">}</span><span class="err">,</span>
  <span class="s2">&#34;outboundDetour&#34;</span><span class="err">:</span> <span class="p">[</span>
    <span class="p">{</span>
    <span class="err">//使用UUID1，路由至下一節點，下一節點使用普通tcp</span>
      <span class="nt">&#34;protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;vmess&#34;</span><span class="p">,</span>
      <span class="nt">&#34;settings&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;vnext&#34;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&#34;address&#34;</span><span class="p">:</span> <span class="s2">&#34;你的ip&#34;</span><span class="p">,</span>
            <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="err">端口</span><span class="p">,</span>
            <span class="nt">&#34;users&#34;</span><span class="p">:</span> <span class="p">[</span>
              <span class="p">{</span>
                <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;和下一節點一致&#34;</span><span class="p">,</span>
                <span class="nt">&#34;alterId&#34;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
                <span class="nt">&#34;security&#34;</span><span class="p">:</span> <span class="s2">&#34;auto&#34;</span>
              <span class="p">}</span>
            <span class="p">]</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="nt">&#34;streamSettings&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;network&#34;</span><span class="p">:</span> <span class="s2">&#34;tcp&#34;</span><span class="p">,</span>
        <span class="nt">&#34;security&#34;</span><span class="p">:</span> <span class="s2">&#34;none&#34;</span>
      <span class="p">},</span>
      <span class="nt">&#34;tag&#34;</span><span class="p">:</span> <span class="s2">&#34;tag1之後會用到&#34;</span>
    <span class="p">},</span>
    <span class="err">//使用UUID</span><span class="mi">2</span><span class="err">，路由至下一節點，採用wss</span>
    <span class="p">{</span>
      <span class="nt">&#34;protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;vmess&#34;</span><span class="p">,</span>
      <span class="nt">&#34;settings&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;vnext&#34;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&#34;address&#34;</span><span class="p">:</span> <span class="s2">&#34;域名&#34;</span><span class="p">,</span>
            <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">443</span><span class="p">,</span>
            <span class="nt">&#34;users&#34;</span><span class="p">:</span> <span class="p">[</span>
              <span class="p">{</span>
                <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;和下一節點一致&#34;</span><span class="p">,</span>
                <span class="nt">&#34;alterId&#34;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
                <span class="nt">&#34;security&#34;</span><span class="p">:</span> <span class="s2">&#34;auto&#34;</span>
              <span class="p">}</span>
            <span class="p">]</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="nt">&#34;streamSettings&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;network&#34;</span><span class="p">:</span> <span class="s2">&#34;ws&#34;</span><span class="p">,</span>
        <span class="nt">&#34;security&#34;</span><span class="p">:</span> <span class="s2">&#34;tls&#34;</span><span class="p">,</span>
        <span class="nt">&#34;wsSettings&#34;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&#34;connectionReuse&#34;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
          <span class="nt">&#34;path&#34;</span><span class="p">:</span> <span class="s2">&#34;/你的path/&#34;</span><span class="p">,</span>
          <span class="nt">&#34;headers&#34;</span><span class="p">:{</span>
            <span class="nt">&#34;Host&#34;</span><span class="p">:</span><span class="s2">&#34;域名&#34;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nt">&#34;tag&#34;</span><span class="p">:</span> <span class="s2">&#34;tag2之後會用到，和上面的不一樣&#34;</span>
    <span class="p">}]</span><span class="err">,</span>
  <span class="s2">&#34;routing&#34;</span><span class="err">:</span> <span class="p">{</span>
  <span class="err">//路由策略</span>
    <span class="nt">&#34;strategy&#34;</span><span class="p">:</span> <span class="s2">&#34;rules&#34;</span><span class="p">,</span>
    <span class="nt">&#34;settings&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;rules&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;field&#34;</span><span class="p">,</span>
          <span class="nt">&#34;user&#34;</span><span class="p">:</span> <span class="s2">&#34;和上面的Email1一致&#34;</span><span class="p">,</span>
          <span class="nt">&#34;outboundTag&#34;</span><span class="p">:</span> <span class="s2">&#34;上面寫的tag1&#34;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;field&#34;</span><span class="p">,</span>
          <span class="nt">&#34;user&#34;</span><span class="p">:</span> <span class="s2">&#34;和上面的Email2一致&#34;</span><span class="p">,</span>
          <span class="nt">&#34;outboundTag&#34;</span><span class="p">:</span> <span class="s2">&#34;上面寫的tag2&#34;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="err">}</span></code></pre></td></tr></table>
</div>
</div>
<h3 id="client">Client</h3>

<p>配置不同的uuid即可</p>

<h1 id="吐槽">吐槽</h1>

<p>英文單詞需要加s&hellip;</p>

<p>一定要记得</p>

<h1 id="contribute">contribute</h1>

<p><a href="https://toutyrater.github.io/" target="_blank">V2Ray 白话文教程</a>
<a href="https://v2ray.com" target="_blank">Project V</a></p>]]></content>
            
            
            
            
            
                
                    
                
                    
                
            
        </entry>
    
</feed>